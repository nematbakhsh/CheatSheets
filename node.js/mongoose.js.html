<!DOCTYPE html>
<html>
<head>
	<title>Mongoose.js Cheat Sheet</title>
	<link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../css/style.css">
</head>
<body class="container">

	<h1>Node.js Mongoose</h1>

	<p>Elegant mongodb object modeling (ODM) for node.js</p>

	<h2>Installation</h2>
	<code class="line-command">npm install --save mongoose</code>

	<h2>Boiler Plate</h2>

<pre class="file-content">
const mongoose = require('mongoose');

mongoose.connect('mongodb://localhost/&ltdatabaseName&gt');

let db = mongoose.connection;

//check connection
db.once('open', function() {
	console.log('Connected to MongoDB');
})

//Check for db errors
db.on('error', function(err) {
	console.log(err);
})

// bring in Models
let &ltModel&gt = require('./models/&ltmodel&gt');
</pre>

<h1>Methods</h1>

<div class="dl-1-2">
	<code class="javascript">mongoose.connect(uri, options);</code>
	<div class="description">Options
		<div class="dl-1-2">
			<code>useNewUrlParser</code>
			<span class="description"> The underlying MongoDB driver has deprecated their current connection string parser. Because this is a major change, they added the useNewUrlParser flag to allow users to fall back to the old parser if they find a bug in the new parser. (Therefore, it should be true! unless there is a problem)</span>

			<code>useUnifiedTopology</code>
			<span class="description"> False by default. Set to true to opt in to using the MongoDB driver's new connection management engine. You should set this option to true, except for the unlikely case that it prevents you from maintaining a stable connection.</span>

			<code>serverSelectionTimeoutMS</code>
			<span class="description">With useUnifiedTopology, the MongoDB driver will try to find a server to send any given operation to, and keep retrying for serverSelectionTimeoutMS milliseconds. If not set, the MongoDB driver defaults to using 30000 (30 seconds).</span>

			<code>heartbeatFrequencyMS</code>
			<span class="description">With useUnifiedTopology, the MongoDB driver sends a heartbeat every heartbeatFrequencyMS to check on the status of the connection</span>

			<code>keepAlive</code>
			<span class="description">is true by default since mongoose 5.2.0.</span>

			<code>keepAliveInitialDelay</code>
			<span class="description">is the number of milliseconds to wait before initiating keepAlive on the socket.</span>

			<code></code>
			<span class="description"></span>

			<code></code>
			<span class="description"></span>
		</div>
	</div>

	<code class="javascript"></code>
	<span class="description"></span>

	<code class="javascript"></code>
	<span class="description"></span>
</div>

<h2>Models</h2>
<p>Inside /Models/model.js</p>
<pre class="file-content">
const mongoose = require('mongoose');
// or
import mongoose from 'mongoose';

const modelStructure = {
    &ltdocumentProperty> : {
        type : String | Number | Date | Buffer | Boolean | Mixed | ObjectId | Array | Decimal128 | Map
        required : true | false
        default : &ltdefaultValue>
    }, 
    ...
    // if a property only requires a type, it can be specified using a shorthand notation
    &ltdocumentProperty> : String | Number | Date | Buffer | Boolean | Mixed | ObjectId | Array | Decimal128 | Map
}

const { Schema } = mongoose;
const modelSchema = new Schema(<span class="datatype-object">OBJECT modelStructure</span>)
// or
const modelSchema = mongoose.Schema(<span class="datatype-object">OBJECT modelStructure</span>)

let &ltmodelName&gt = module.exports = mongoose.model(<span class="datatype-string">STRING modelName</span>, modelSchema);
</pre>

	<h2>Model methods</h2>

	<div class="dl-1-2">
<pre class="javascript">
&ltModel&gt.find({}, function(err, res) {
	if (err) {
		console.log(err)
	} else {
		// your code
	}
});</pre>
<span class="description"></span>

<pre class="javascript">
&ltModel&gt.findById({}, function(err, res) {
	if (err) {
		console.log(err)
	} else {
		// your code
	}
});</pre>
<span class="description"></span>

<pre class="javascript">
&ltModel&gt.save( function(err, res) {
	if (err) {
		console.log(err);
		return;
	} else {
		// your code
		//res.redirect('/');
	}
});</pre>
<span class="description"></span>

<pre class="javascript">
&ltModel&gt.update(query, object, function(err) {
	if (err) {
		console.log(err);
		return;
	} else {
		// your code
		//res.redirect('/');
	}
});</pre>
<span class="description"></span>

<pre class="javascript">
&ltModel&gt.remove(query, function(err) {
	if (err) {
		console.log(err);
		return;
	} else {
		// your code
		//res.send('Success');
	}
});</pre>
<span class="description"></span>
	</div>

</body>
</html>